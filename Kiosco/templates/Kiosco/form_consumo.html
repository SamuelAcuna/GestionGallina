{% extends 'Kiosco/base_kiosco.html' %}

{% block content %}
<h3 class="text-center mb-4">Registrar Consumo - {{ lote.galpon.nombre }}</h3>

<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card p-4 shadow-sm border-0" style="border-radius: 15px;">
            <form method="post">
                {% csrf_token %}

                <div class="mb-4">
                    <label class="form-label h5">Alimento / Insumo</label>
                    <select name="articulo" class="form-select form-select-lg" required>
                        <option value="" selected disabled>Seleccione...</option>
                        {% for item in alimentos %}
                        <option value="{{ item.pk }}">{{ item.nombre }} ({{ item.unidad_medida }})</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-4">
                    <label class="form-label h5">Cantidad</label>
                    <div class="input-group">
                        <button type="button" class="btn btn-outline-danger" onclick="removeQuantity(25)">
                            - 25 Kg
                        </button>
                        <input type="number" step="0.01" name="cantidad" id="input-cantidad"
                            class="form-control form-control-lg" placeholder="10.5" required>
                        <button type="button" class="btn btn-outline-primary" onclick="addQuantity(25)">
                            + 25 Kg
                        </button>
                    </div>
                    <div class="form-text">Presione "+ 25 Kg" para sumar bolsas.</div>
                </div>

                <button type="submit" class="btn btn-warning btn-lg w-100 py-3 fw-bold">
                    <i class="bi bi-check-lg"></i> GUARDAR CONSUMO
                </button>
            </form>
        </div>
    </div>
</div>

<script>
    function addQuantity(amount) {
        const input = document.getElementById('input-cantidad');
        let currentVal = parseFloat(input.value) || 0;
        input.value = (currentVal + amount).toFixed(2);
    }
    function removeQuantity(amount) {
        const input = document.getElementById('input-cantidad');
        let currentVal = parseFloat(input.value) || 0;
        if (currentVal - amount >= 0) {
            input.value = (currentVal - amount).toFixed(2);
        }
    }
</script>

<!-- Daily Log -->
<div class="row justify-content-center mt-5">
    <div class="col-md-8">
        <h5 class="text-center mb-3">Registros de Hoy</h5>
        <div class="table-responsive">
            <table class="table table-bordered table-striped text-center">
                <thead class="table-light">
                    <tr>
                        <th>Hora</th>
                        <th>Artículo</th>
                        <th>Cant.</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in movimientos %}
                    <tr>
                        <td>{{ m.fecha|date:"H:i" }}</td>
                        <td>{{ m.articulo.nombre }}</td>
                        <td>{{ m.cantidad }} {{ m.articulo.unidad_medida }}</td>
                        <td>
                            <a href="{% url 'kiosco-movimiento-edit' m.pk %}" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-pencil"></i>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-muted">Sin registros hoy</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="text-center mt-4">
    <a href="{% url 'kiosco-menu' lote.pk %}" class="btn btn-outline-secondary btn-lg px-5">
        <i class="bi bi-x-lg"></i> Cancelar
    </a>
</div>
{% endblock %}